vjust = -0.5, size = 5, fontface = "bold") +
scale_fill_manual(values = c("Awareness" = "#3498DB", "Consideration" = "#2ECC71",
"Conversion" = "#F39C12", "Retention" = "#9B59B6")) +
labs(title = "Conversion Rate by Campaign Type",
subtitle = "Which funnel stages perform best?",
x = "Campaign Type", y = "Conversion Rate (%)") +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)),
limits = c(0, max(type_conversion$ConvRate) * 1.12)) +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40"),
legend.position = "none",
panel.grid.major.x = element_blank())
ggsave(file.path(plot_dir, "07_conversion_by_type.png"), p7,
width = 10, height = 6, dpi = 300, bg = "white")
# ============================================================
# 8. Conversion Rate by Channel x Type
# ============================================================
channel_type_conversion <- df %>%
group_by(CampaignChannel, CampaignType) %>%
summarise(
Total = n(),
Conversions = sum(Conversion_numeric),
ConvRate = mean(Conversion_numeric) * 100,
.groups = 'drop'
)
p8 <- ggplot(channel_type_conversion, aes(x = CampaignChannel, y = ConvRate, fill = CampaignType)) +
geom_bar(stat = "identity", position = "dodge", color = "black", size = 0.5) +
geom_text(aes(label = paste0(round(ConvRate, 1), "%")),
position = position_dodge(width = 0.9),
vjust = -0.5, size = 3) +
scale_fill_manual(values = c("Awareness" = "#3498DB", "Consideration" = "#2ECC71",
"Conversion" = "#F39C12", "Retention" = "#9B59B6")) +
labs(title = "Conversion Rate by Campaign Channel x Campaign Type",
subtitle = "Best performing channel-type combinations",
x = "Campaign Channel", y = "Conversion Rate (%)",
fill = "Campaign Type") +
scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "right",
panel.grid.major.x = element_blank())
ggsave(file.path(plot_dir, "08_conversion_channel_type.png"), p8,
width = 12, height = 6, dpi = 300, bg = "white")
# ============================================================
# 9. Strategy Heatmap: Channel vs Type
# ============================================================
heatmap_data <- df %>%
group_by(CampaignChannel, CampaignType) %>%
summarise(
ConvRate = mean(Conversion_numeric),
Count = n(),
.groups = 'drop'
)
p9 <- ggplot(heatmap_data, aes(x = CampaignChannel, y = CampaignType, fill = ConvRate)) +
geom_tile(color = "white") +
geom_text(aes(label = percent(ConvRate, accuracy = 0.1)), color = "white", fontface = "bold") +
scale_fill_gradient(low = "#3498db", high = "#e74c3c") +
labs(title = "Conversion Rate Heatmap: Channel vs Type",
subtitle = "Red indicates high performance combinations",
x = "Channel", y = "Campaign Type", fill = "Conv. Rate") +
theme_minimal()
ggsave(file.path(plot_dir, "09_strategy_heatmap.png"), p9, width = 8, height = 5)
# ============================================================
# 10. AdSpend by Conversion across Campaign Channels
# ============================================================
p10 <- ggplot(df, aes(x = Conversion, y = AdSpend, fill = Conversion)) +
geom_boxplot(outlier.alpha = 0.3) +
scale_fill_manual(values = c("No" = "#E74C3C", "Yes" = "#2ECC71")) +
facet_wrap(~ CampaignChannel, scales = "free_y") +
labs(title = "Ad Spend by Conversion across Campaign Channels",
x = "Conversion", y = "Ad Spend (EUR)") +
theme_minimal() + theme(legend.position = "bottom")
ggsave(file.path(plot_dir, "10_adspend_by_channel.png"), p10, width = 12, height = 6)
# ============================================================
# 11. AdSpend ROI Curve
# ============================================================
adspend_bins <- df %>%
mutate(SpendGroup = cut_number(AdSpend, n = 5,
labels = c("Very Low", "Low", "Medium", "High", "Very High"))) %>%
group_by(SpendGroup) %>%
summarise(
ConvRate = mean(Conversion_numeric),
AvgSpend = mean(AdSpend),
.groups = 'drop'
)
p11 <- ggplot(adspend_bins, aes(x = AvgSpend, y = ConvRate)) +
geom_line(group = 1, color = "darkblue", size = 1) +
geom_point(size = 3, color = "red") +
geom_text(aes(label = percent(ConvRate, accuracy = 0.1)), vjust = -0.5) +
labs(title = "AdSpend ROI Curve",
subtitle = "Does Conversion Rate increase linearly with Spend?",
x = "Average Ad Spend (EUR)", y = "Conversion Rate") +
theme_minimal()
ggsave(file.path(plot_dir, "11_adspend_roi_curve.png"), p11, width = 8, height = 5)
# ============================================================
# 12. Correlation Heatmap
# ============================================================
num_df <- df %>% select(where(is.numeric), -Conversion_numeric)
cor_matrix <- cor(num_df, use = "complete.obs")
png(file.path(plot_dir, "12_correlation_heatmap.png"), width = 900, height = 800)
corrplot(
cor_matrix,
method      = "color",
type        = "lower",
tl.col      = "black",
tl.cex      = 0.8,
addCoef.col = "black",
number.cex  = 0.6,
title       = "Correlation Matrix of Numeric Variables",
mar         = c(0, 0, 2, 0)
)
dev.off()
# ============================================================
# 13. Summary Statistics (table image)
# ============================================================
library(gridExtra)
summary_long <- df %>%
select(where(is.numeric), Conversion, -Conversion_numeric) %>%
pivot_longer(cols = -Conversion, names_to = "Variable", values_to = "Value") %>%
group_by(Variable, Conversion) %>%
summarise(
Mean   = round(mean(Value, na.rm = TRUE), 2),
SD     = round(sd(Value, na.rm = TRUE), 2),
Median = round(median(Value, na.rm = TRUE), 2),
Min    = round(min(Value, na.rm = TRUE), 2),
Max    = round(max(Value, na.rm = TRUE), 2),
.groups = "drop"
)
table_no  <- summary_long %>% filter(Conversion == "No") %>% select(-Conversion)
table_yes <- summary_long %>% filter(Conversion == "Yes") %>% select(-Conversion)
png(file.path(plot_dir, "13_summary_table.png"), width = 1100, height = 1400, res = 150)
grid.arrange(
grid::textGrob("Non-Converted (No)", gp = grid::gpar(fontsize = 12, fontface = "bold")),
tableGrob(table_no, rows = NULL, theme = ttheme_minimal(
core    = list(fg_params = list(fontsize = 9), padding = unit(c(8, 8), "mm")),
colhead = list(fg_params = list(fontsize = 10, fontface = "bold"), padding = unit(c(8, 8), "mm"))
)),
grid::textGrob(""),
grid::textGrob("Converted (Yes)", gp = grid::gpar(fontsize = 12, fontface = "bold")),
tableGrob(table_yes, rows = NULL, theme = ttheme_minimal(
core    = list(fg_params = list(fontsize = 9), padding = unit(c(8, 8), "mm")),
colhead = list(fg_params = list(fontsize = 10, fontface = "bold"), padding = unit(c(8, 8), "mm"))
)),
nrow = 5,
heights = c(0.5, 5, 1, 0.5, 5)
)
dev.off()
cat("\n========================================\n")
cat("EDA complete. All plots saved to:", plot_dir, "\n")
cat("========================================\n")
# ============================================================
# 02_eda.R â€” Exploratory Data Analysis for Marketing Conversion
# ============================================================
#-----------------------------------
# Set working directory
#-----------------------------------
setwd("C:/Users/sejdi/Desktop/Lancaster University Masters - Leipzig/Data Science Fundamentals/LZSCC.460-Group-Project")
#-----------------------------------
# Load libraries and utilities
#-----------------------------------
library(ggplot2)
library(dplyr)
library(tidyr)
library(corrplot)
library(GGally)
library(scales)
library(patchwork)
library(gridExtra)
library(grid)
source("utils/utils.R")
source("01_preprocessing.R")
#-----------------------------------
# Load and preprocess data
#-----------------------------------
marketing_data <- read.csv("marketing.csv")
prep <- preprocess_data(
data       = marketing_data,
target_col = "Conversion",
id_cols    = "CustomerID",
filter_col = "ConversionRate",
filter_min = 0,
filter_max = 1,
train_prop = 0.8,
stratify   = TRUE,
seed       = 123,
model_type = "glmnet"
)
df <- prep$full_processed_data
# Ensure Conversion is a factor with readable labels
df$Conversion <- factor(df$Conversion, levels = c(0, 1), labels = c("No", "Yes"))
# Numeric version for computing rates
df$Conversion_numeric <- ifelse(df$Conversion == "Yes", 1, 0)
# Verify both classes exist
cat("Conversion counts:\n")
print(table(df$Conversion))
#-----------------------------------
# Output directory for plots
#-----------------------------------
plot_dir <- "plots/"
if (!dir.exists(plot_dir)) dir.create(plot_dir, recursive = TRUE)
# ============================================================
# 1. Target Variable & Demographics vs Conversion
# ============================================================
p1 <- ggplot(df, aes(x = Conversion, fill = Conversion)) +
geom_bar() +
geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
scale_fill_manual(values = c("No" = "#E74C3C", "Yes" = "#2ECC71")) +
labs(title = "Class Balance", x = "Conversion", y = "Count") +
theme_minimal() + theme(legend.position = "none")
p2a <- ggplot(df, aes(x = Age, fill = Conversion)) +
geom_density(alpha = 0.5) +
scale_fill_manual(values = c("No" = "#E74C3C", "Yes" = "#2ECC71")) +
labs(title = "Age Distribution", x = "Age", y = "Density") +
theme_minimal() + theme(legend.position = "none")
p2b <- ggplot(df, aes(x = Income, fill = Conversion)) +
geom_density(alpha = 0.5) +
scale_fill_manual(values = c("No" = "#E74C3C", "Yes" = "#2ECC71")) +
labs(title = "Income Distribution", x = "Income (EUR)", y = "Density") +
theme_minimal() + theme(legend.position = "none")
p2c <- ggplot(df, aes(x = Gender, fill = Conversion)) +
geom_bar(position = "dodge") +
geom_text(stat = "count", aes(label = after_stat(count)),
position = position_dodge(width = 0.9), vjust = -0.5) +
scale_fill_manual(values = c("No" = "#E74C3C", "Yes" = "#2ECC71")) +
labs(title = "Conversion by Gender", x = "Gender", y = "Count") +
theme_minimal()
p_combined <- (p1 | p2a | p2b | p2c) +
plot_annotation(title = "Target Distribution & Demographics vs Conversion")
ggsave(file.path(plot_dir, "01_target_and_demographics.png"), p_combined, width = 18, height = 5)
# ============================================================
# 2. Campaign Channel Distribution
# ============================================================
df$CampaignChannel <- factor(df$CampaignChannel)
channel_summary <- df %>%
group_by(CampaignChannel) %>%
summarise(Count = n(), .groups = 'drop') %>%
mutate(Percentage = Count / sum(Count) * 100,
Label = paste0(Count, " (", round(Percentage, 1), "%)")) %>%
arrange(Count)
channel_summary$CampaignChannel <- factor(channel_summary$CampaignChannel,
levels = channel_summary$CampaignChannel)
p_channel_dist <- ggplot(channel_summary, aes(x = CampaignChannel, y = Count, fill = CampaignChannel)) +
geom_bar(stat = "identity", width = 0.7, color = "black", size = 0.5) +
geom_text(aes(label = Label), hjust = -0.1, size = 4, fontface = "bold") +
coord_flip() +
scale_fill_manual(values = c("PPC" = "#3498DB", "Referral" = "#E74C3C",
"SEO" = "#2ECC71", "Social Media" = "#9B59B6",
"Email" = "#F39C12")) +
labs(title = "Distribution of Campaign Channels",
subtitle = paste0("Total Observations: ", sum(channel_summary$Count)),
x = "Campaign Channel", y = "Number of Observations") +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)),
limits = c(0, max(channel_summary$Count) * 1.15)) +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40"),
legend.position = "none",
panel.grid.major.y = element_blank())
ggsave(file.path(plot_dir, "02_campaign_channel_distribution.png"), p_channel_dist,
width = 10, height = 6, dpi = 300, bg = "white")
# ============================================================
# 3. Campaign Type Distribution
# ============================================================
type_summary <- df %>%
group_by(CampaignType) %>%
summarise(Count = n(), .groups = 'drop') %>%
mutate(Percentage = Count / sum(Count) * 100,
Label = paste0(Count, " (", round(Percentage, 1), "%)")) %>%
arrange(Count)
type_summary$CampaignType <- factor(type_summary$CampaignType,
levels = type_summary$CampaignType)
p_type_dist <- ggplot(type_summary, aes(x = CampaignType, y = Count, fill = CampaignType)) +
geom_bar(stat = "identity", width = 0.7, color = "black", size = 0.5) +
geom_text(aes(label = Label), hjust = -0.1, size = 4, fontface = "bold") +
coord_flip() +
scale_fill_manual(values = c("Awareness" = "#3498DB", "Consideration" = "#2ECC71",
"Conversion" = "#F39C12", "Retention" = "#9B59B6")) +
labs(title = "Distribution of Campaign Types",
subtitle = paste0("Total Observations: ", sum(type_summary$Count)),
x = "Campaign Type", y = "Number of Observations") +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)),
limits = c(0, max(type_summary$Count) * 1.15)) +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40"),
legend.position = "none",
panel.grid.major.y = element_blank())
ggsave(file.path(plot_dir, "03_campaign_type_distribution.png"), p_type_dist,
width = 10, height = 6, dpi = 300, bg = "white")
# ============================================================
# 4. Conversion by Campaign Channel & AdSpend
# ============================================================
p4a <- ggplot(df, aes(x = CampaignChannel, fill = Conversion)) +
geom_bar(position = "dodge") +
geom_text(stat = "count", aes(label = after_stat(count)),
position = position_dodge(width = 0.9), vjust = -0.5, size = 3) +
scale_fill_manual(values = c("No" = "#E74C3C", "Yes" = "#2ECC71")) +
labs(title = "Conversion by Campaign Channel", x = "Campaign Channel", y = "Count") +
theme_minimal()
ggsave(file.path(plot_dir, "04a_channel_conversion.png"), p4a, width = 7, height = 5)
p4b <- ggplot(df, aes(x = Conversion, y = AdSpend, fill = Conversion)) +
geom_boxplot(outlier.alpha = 0.3) +
scale_fill_manual(values = c("No" = "#E74C3C", "Yes" = "#2ECC71")) +
labs(title = "Ad Spend by Conversion", x = "Conversion", y = "Ad Spend (EUR)") +
theme_minimal() +
theme(legend.position = "none")
ggsave(file.path(plot_dir, "04b_adspend_boxplot.png"), p4b, width = 6, height = 5)
# ============================================================
# 5. Engagement Metrics vs Conversion (combined)
# ============================================================
engagement_vars <- c("ClickThroughRate", "ConversionRate", "WebsiteVisits",
"PagesPerVisit", "TimeOnSite", "SocialShares",
"EmailOpens", "EmailClicks")
engagement_long <- df %>%
select(all_of(engagement_vars), Conversion) %>%
pivot_longer(cols = -Conversion, names_to = "Metric", values_to = "Value")
p5 <- ggplot(engagement_long, aes(x = Conversion, y = Value, fill = Conversion)) +
geom_boxplot(outlier.alpha = 0.3) +
scale_fill_manual(values = c("No" = "#E74C3C", "Yes" = "#2ECC71")) +
facet_wrap(~ Metric, scales = "free_y", ncol = 4) +
labs(title = "Engagement Metrics by Conversion", x = "Conversion", y = "") +
theme_minimal() +
theme(legend.position = "bottom")
ggsave(file.path(plot_dir, "05_engagement_boxplots.png"), p5, width = 14, height = 8)
# ============================================================
# 6. Historical Behavior vs Conversion (combined)
# ============================================================
history_vars <- c("PreviousPurchases", "LoyaltyPoints")
history_long <- df %>%
select(all_of(history_vars), Conversion) %>%
pivot_longer(cols = -Conversion, names_to = "Metric", values_to = "Value")
p6 <- ggplot(history_long, aes(x = Conversion, y = Value, fill = Conversion)) +
geom_boxplot(outlier.alpha = 0.3) +
scale_fill_manual(values = c("No" = "#E74C3C", "Yes" = "#2ECC71")) +
facet_wrap(~ Metric, scales = "free_y", ncol = 2) +
labs(title = "Historical Behavior by Conversion", x = "Conversion", y = "") +
theme_minimal() +
theme(legend.position = "bottom")
ggsave(file.path(plot_dir, "06_historical_boxplots.png"), p6, width = 8, height = 5)
# ============================================================
# 7. Conversion Rate by Campaign Type
# ============================================================
type_conversion <- df %>%
group_by(CampaignType) %>%
summarise(
Total = n(),
Conversions = sum(Conversion_numeric),
ConvRate = mean(Conversion_numeric) * 100,
.groups = 'drop'
) %>%
arrange(desc(ConvRate))
type_conversion$CampaignType <- factor(type_conversion$CampaignType,
levels = type_conversion$CampaignType)
p7 <- ggplot(type_conversion, aes(x = CampaignType, y = ConvRate, fill = CampaignType)) +
geom_bar(stat = "identity", width = 0.7, color = "black", size = 0.5) +
geom_text(aes(label = paste0(round(ConvRate, 1), "%")),
vjust = -0.5, size = 5, fontface = "bold") +
scale_fill_manual(values = c("Awareness" = "#3498DB", "Consideration" = "#2ECC71",
"Conversion" = "#F39C12", "Retention" = "#9B59B6")) +
labs(title = "Conversion Rate by Campaign Type",
subtitle = "Which funnel stages perform best?",
x = "Campaign Type", y = "Conversion Rate (%)") +
scale_y_continuous(expand = expansion(mult = c(0, 0.15)),
limits = c(0, max(type_conversion$ConvRate) * 1.12)) +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40"),
legend.position = "none",
panel.grid.major.x = element_blank())
ggsave(file.path(plot_dir, "07_conversion_by_type.png"), p7,
width = 10, height = 6, dpi = 300, bg = "white")
# ============================================================
# 8. Conversion Rate by Channel x Type
# ============================================================
channel_type_conversion <- df %>%
group_by(CampaignChannel, CampaignType) %>%
summarise(
Total = n(),
Conversions = sum(Conversion_numeric),
ConvRate = mean(Conversion_numeric) * 100,
.groups = 'drop'
)
p8 <- ggplot(channel_type_conversion, aes(x = CampaignChannel, y = ConvRate, fill = CampaignType)) +
geom_bar(stat = "identity", position = "dodge", color = "black", size = 0.5) +
geom_text(aes(label = paste0(round(ConvRate, 1), "%")),
position = position_dodge(width = 0.9),
vjust = -0.5, size = 3) +
scale_fill_manual(values = c("Awareness" = "#3498DB", "Consideration" = "#2ECC71",
"Conversion" = "#F39C12", "Retention" = "#9B59B6")) +
labs(title = "Conversion Rate by Campaign Channel x Campaign Type",
subtitle = "Best performing channel-type combinations",
x = "Campaign Channel", y = "Conversion Rate (%)",
fill = "Campaign Type") +
scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "right",
panel.grid.major.x = element_blank())
ggsave(file.path(plot_dir, "08_conversion_channel_type.png"), p8,
width = 12, height = 6, dpi = 300, bg = "white")
# ============================================================
# 9. Strategy Heatmap: Channel vs Type
# ============================================================
heatmap_data <- df %>%
group_by(CampaignChannel, CampaignType) %>%
summarise(
ConvRate = mean(Conversion_numeric),
Count = n(),
.groups = 'drop'
)
p9 <- ggplot(heatmap_data, aes(x = CampaignChannel, y = CampaignType, fill = ConvRate)) +
geom_tile(color = "white") +
geom_text(aes(label = percent(ConvRate, accuracy = 0.1)), color = "white", fontface = "bold") +
scale_fill_gradient(low = "#3498db", high = "#e74c3c") +
labs(title = "Conversion Rate Heatmap: Channel vs Type",
subtitle = "Red indicates high performance combinations",
x = "Channel", y = "Campaign Type", fill = "Conv. Rate") +
theme_minimal()
ggsave(file.path(plot_dir, "09_strategy_heatmap.png"), p9, width = 8, height = 5)
# ============================================================
# 10. AdSpend by Conversion across Campaign Channels
# ============================================================
p10 <- ggplot(df, aes(x = Conversion, y = AdSpend, fill = Conversion)) +
geom_boxplot(outlier.alpha = 0.3) +
scale_fill_manual(values = c("No" = "#E74C3C", "Yes" = "#2ECC71")) +
facet_wrap(~ CampaignChannel, scales = "free_y") +
labs(title = "Ad Spend by Conversion across Campaign Channels",
x = "Conversion", y = "Ad Spend (EUR)") +
theme_minimal() + theme(legend.position = "bottom")
ggsave(file.path(plot_dir, "10_adspend_by_channel.png"), p10, width = 12, height = 6)
# ============================================================
# 11. AdSpend ROI Curve
# ============================================================
adspend_bins <- df %>%
mutate(SpendGroup = cut_number(AdSpend, n = 5,
labels = c("Very Low", "Low", "Medium", "High", "Very High"))) %>%
group_by(SpendGroup) %>%
summarise(
ConvRate = mean(Conversion_numeric),
AvgSpend = mean(AdSpend),
.groups = 'drop'
)
p11 <- ggplot(adspend_bins, aes(x = AvgSpend, y = ConvRate)) +
geom_line(group = 1, color = "darkblue", size = 1) +
geom_point(size = 3, color = "red") +
geom_text(aes(label = percent(ConvRate, accuracy = 0.1)), vjust = -0.5) +
labs(title = "AdSpend ROI Curve",
subtitle = "Does Conversion Rate increase linearly with Spend?",
x = "Average Ad Spend (EUR)", y = "Conversion Rate") +
theme_minimal()
ggsave(file.path(plot_dir, "11_adspend_roi_curve.png"), p11, width = 8, height = 5)
# ============================================================
# 12. Correlation Heatmap
# ============================================================
num_df <- df %>% select(where(is.numeric), -Conversion_numeric)
cor_matrix <- cor(num_df, use = "complete.obs")
png(file.path(plot_dir, "12_correlation_heatmap.png"), width = 900, height = 800)
corrplot(
cor_matrix,
method      = "color",
type        = "lower",
tl.col      = "black",
tl.cex      = 0.8,
addCoef.col = "black",
number.cex  = 0.6,
title       = "Correlation Matrix of Numeric Variables",
mar         = c(0, 0, 2, 0)
)
dev.off()
# ============================================================
# 13. Summary Statistics (table image)
# ============================================================
library(gridExtra)
summary_long <- df %>%
select(where(is.numeric), Conversion, -Conversion_numeric) %>%
pivot_longer(cols = -Conversion, names_to = "Variable", values_to = "Value") %>%
group_by(Variable, Conversion) %>%
summarise(
Mean   = round(mean(Value, na.rm = TRUE), 2),
SD     = round(sd(Value, na.rm = TRUE), 2),
Median = round(median(Value, na.rm = TRUE), 2),
Min    = round(min(Value, na.rm = TRUE), 2),
Max    = round(max(Value, na.rm = TRUE), 2),
.groups = "drop"
)
table_no  <- summary_long %>% filter(Conversion == "No") %>% select(-Conversion)
table_yes <- summary_long %>% filter(Conversion == "Yes") %>% select(-Conversion)
png(file.path(plot_dir, "13_summary_table.png"), width = 1100, height = 1800, res = 150)
grid.arrange(
grid::textGrob("Non-Converted (No)", gp = grid::gpar(fontsize = 12, fontface = "bold")),
tableGrob(table_no, rows = NULL, theme = ttheme_minimal(
core    = list(fg_params = list(fontsize = 9), padding = unit(c(6, 6), "mm")),
colhead = list(fg_params = list(fontsize = 10, fontface = "bold"), padding = unit(c(6, 6), "mm"))
)),
grid::textGrob(""),
grid::textGrob("Converted (Yes)", gp = grid::gpar(fontsize = 12, fontface = "bold")),
tableGrob(table_yes, rows = NULL, theme = ttheme_minimal(
core    = list(fg_params = list(fontsize = 9), padding = unit(c(6, 6), "mm")),
colhead = list(fg_params = list(fontsize = 10, fontface = "bold"), padding = unit(c(6, 6), "mm"))
)),
nrow = 5,
heights = c(1, 12, 2, 1, 12)
)
dev.off()
cat("\n========================================\n")
cat("EDA complete. All plots saved to:", plot_dir, "\n")
cat("========================================\n")
